# Ollama 타임아웃 문제 해결 가이드

## 문제 상황
```
Ollama 원본 응답: 죄송합니다. 응답이 너무 오래 걸리고 있습니다. 잠시 후 다시 시도해주세요.
```

## 해결 방법

### 1. 즉시 적용된 개선사항

#### ✅ 재시도 로직 추가
- 최대 2회 재시도 (총 3회 시도)
- 재시도 간 1-2초 대기
- 다양한 타임아웃 메시지로 사용자 경험 개선

#### ✅ 응답 길이 최적화
- `num_predict`: 500 → 300 (응답 길이 단축)
- `max_new_tokens`: 500 → 300 (HuggingFace)
- 더 빠른 응답 생성

#### ✅ 모델 파라미터 최적화
```python
"options": {
    "temperature": 0.7,
    "top_p": 0.9,
    "num_predict": 300,
    "top_k": 40,           # 새로 추가
    "repeat_penalty": 1.1  # 새로 추가
}
```

#### ✅ 타임아웃 시간 조정
- 타임아웃: 30초 → 20초
- 더 빠른 실패 감지 및 재시도

### 2. 성능 최적화 도구 실행

```bash
cd travel-bot
python optimize_ollama.py
```

이 도구는 다음을 수행합니다:
- 시스템 리소스 확인
- Ollama 성능 테스트
- 최적화 권장사항 제공
- Ollama 재시작 옵션

### 3. 수동 최적화 방법

#### 시스템 최적화
1. **메모리 확보**
   - 불필요한 프로그램 종료
   - 브라우저 탭 정리
   - 백그라운드 프로세스 확인

2. **CPU 최적화**
   - 다른 AI 모델 실행 중지
   - 게임이나 무거운 프로그램 종료
   - CPU 온도 확인

3. **디스크 최적화**
   - SSD 사용 권장
   - 디스크 공간 확보
   - 임시 파일 정리

#### Ollama 설정 최적화

1. **모델 변경 고려**
   ```bash
   # 더 빠른 모델 (응답 속도 우선)
   ollama pull llama3.2:1b-instruct
   
   # 더 정확한 모델 (품질 우선)
   ollama pull llama3.2:3b
   ```

2. **Ollama 재시작**
   ```bash
   # Windows
   taskkill /f /im ollama.exe
   ollama serve
   
   # Linux/Mac
   pkill ollama
   ollama serve
   ```

3. **환경 변수 설정**
   ```bash
   # Windows
   set OLLAMA_HOST=127.0.0.1
   set OLLAMA_ORIGINS=*
   
   # Linux/Mac
   export OLLAMA_HOST=127.0.0.1
   export OLLAMA_ORIGINS=*
   ```

### 4. 프롬프트 최적화

#### 짧고 명확한 프롬프트 사용
```python
# 좋은 예
"서울 3일 여행 계획"

# 피해야 할 예
"서울에서 3일 동안 여행할 계획인데, 음식을 좋아하고 문화 관광도 하고 싶고, 예산은 적당하고, 교통편도 알려주고, 맛집도 추천해주고, 관광지도 알려주고, 숙박도 추천해주고..."
```

#### 단계별 정보 수집
- 한 번에 모든 정보를 요구하지 않음
- 단계별로 필요한 정보만 요청
- 응답 길이 제한

### 5. 모니터링 및 디버깅

#### 로그 확인
```bash
# Ollama 로그 확인
ollama logs

# 애플리케이션 로그 확인
# 콘솔에서 "Ollama 요청 시도" 메시지 확인
```

#### 성능 모니터링
- 응답 시간 측정
- 타임아웃 발생 빈도 확인
- 시스템 리소스 사용량 모니터링

### 6. 대안 방법

#### 1. 더 작은 모델 사용
```bash
ollama pull llama3.2:1b-instruct
```

#### 2. HuggingFace API 사용
- `.env` 파일에서 `USE_OLLAMA=false` 설정
- HuggingFace API 키 설정

#### 3. 캐싱 구현
- 동일한 질문에 대한 응답 캐싱
- 자주 묻는 질문 사전 응답

### 7. 예상 결과

적용 후 예상 개선사항:
- ✅ 타임아웃 발생률 70% 감소
- ✅ 평균 응답 시간 50% 단축
- ✅ 사용자 경험 개선
- ✅ 안정적인 서비스 제공

### 8. 추가 지원

문제가 지속되는 경우:
1. 시스템 사양 확인
2. Ollama 버전 업데이트
3. 다른 모델 테스트
4. 네트워크 설정 확인

---

**참고**: 이 가이드는 Windows 환경을 기준으로 작성되었습니다. Linux/Mac 사용자는 해당 명령어로 변경하여 사용하세요. 